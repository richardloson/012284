<!-- Agrega esto en tu HTML (idealmente al final del <body>) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
<script>
    async function exportToPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // üñº Encabezado con logo y t√≠tulo
        const logo = new Image();
        logo.src = 'icons/banner.png';
        await new Promise(resolve => logo.onload = resolve);
        doc.addImage(logo, 'PNG', 80, 10, 50, 20);
        doc.setFontSize(16);
        doc.setTextColor(52, 71, 103);
        doc.text('Reporte de Mantenimiento de Sistemas de Bombeo', 20, 40);

        let yOffset = 50;

        // üß† Funci√≥n para generar tabla por secci√≥n
        function addSection(title, data) {
            doc.setFontSize(14);
            doc.setTextColor(0, 102, 204);
            doc.text(title, 20, yOffset);
            yOffset += 5;

            doc.autoTable({
                startY: yOffset,
                head: [['Par√°metro', 'Valor']],
                body: data,
                styles: {
                    fontSize: 10,
                    cellPadding: 2,
                    valign: 'middle',
                },
                headStyles: {
                    fillColor: [179, 197, 214],
                    textColor: 40,
                    halign: 'center',
                    fontStyle: 'bold'
                },
                theme: 'grid',
                margin: { left: 20, right: 20 }
            });

            yOffset = doc.lastAutoTable.finalY + 10;
        }

        // üßæ Recolectar datos de cada secci√≥n
        const jockeyData = [
            ['V. Entrada L1-L2', document.getElementById('jockey-v-entrada-l1l2').value],
            ['V. Entrada L1-L3', document.getElementById('jockey-v-entrada-l1l3').value],
            ['V. Entrada L2-L3', document.getElementById('jockey-v-entrada-l2l3').value],
            ['V. Salida', document.getElementById('jockey-v-salida').value],
            ['Par√°metros Inicio/Paro', document.getElementById('jockey-parametros').value],
            ['Lectura Inicio', document.getElementById('jockey-lecturas-inicio').value],
            ['Lectura Paro', document.getElementById('jockey-lecturas-paro').value],
            ['Amperaje L1', document.getElementById('jockey-amperaje-l1').value],
            ['Amperaje L2', document.getElementById('jockey-amperaje-l2').value],
            ['Amperaje L3', document.getElementById('jockey-amperaje-l3').value],
            ['Descarga PSI', document.getElementById('jockey-descarga').value]
        ];

        const electricaData = [
            ['V. Entrada', document.getElementById('electrica-v-entrada').value],
            ['V. Salida', document.getElementById('electrica-v-salida').value],
            ['Par√°metros Inicio/Paro', document.getElementById('electrica-parametros').value],
            ['Lectura Inicio', document.getElementById('electrica-lecturas-inicio').value],
            ['Lectura Paro', document.getElementById('electrica-lecturas-paro').value],
            ['Amperaje L1', document.getElementById('electrica-amperaje-l1').value],
            ['Amperaje L2', document.getElementById('electrica-amperaje-l2').value],
            ['Amperaje L3', document.getElementById('electrica-amperaje-l3').value],
            ['Descarga PSI', document.getElementById('electrica-descarga').value]
        ];

        const dieselData = [
            ['Niveles Agua', document.getElementById('diesel-nivel-agua').value],
            ['Niveles Aceite', document.getElementById('diesel-nivel-aceite').value],
            ['Par√°metros Inicio/Paro', document.getElementById('diesel-parametros').value],
            ['Diesel +3/4', document.getElementById('diesel-diesel-3cuarto').checked ? 'S√≠' : 'No'],
            ['Diesel -3/4', document.getElementById('diesel-diesel-menos3cuarto').checked ? 'S√≠' : 'No'],
            ['Litros faltan', document.getElementById('diesel-litros-faltan').value],
            ['Lectura Inicio', document.getElementById('diesel-lecturas-inicio').value],
            ['Lectura Paro', document.getElementById('diesel-lecturas-paro').value],
            ['Velocidad RPM', document.getElementById('diesel-velocidad').value],
            ['VAC', document.getElementById('diesel-vac').value],
            ['Presi√≥n Aceite', document.getElementById('diesel-presion-aceite').value],
            ['Temperatura Inicial (¬∞C)', document.getElementById('diesel-temp-inicial').value],
            ['Temperatura Final (¬∞C)', document.getElementById('diesel-temp-final').value],
            ['Hrs. Inicial', document.getElementById('diesel-hrs-inicial').value],
            ['Hrs. Final', document.getElementById('diesel-hrs-final').value],
            ['Observaciones', document.getElementById('diesel-observaciones').value || 'Ninguna']
        ];

        // üö∞ Hidrantes din√°micos
        const hidrantes = [];
        const totalHidrantes = document.querySelectorAll('[id^="hidrante-"][id$="-ok"]').length;
        for (let i = 1; i <= totalHidrantes; i++) {
            hidrantes.push([
                `Hidrante ${i}`,
                (document.getElementById(`hidrante-${i}-ok`).checked ? 'OK' : 'No OK') +
                ' ‚Äî ' + (document.getElementById(`hidrante-${i}-comentarios`).value || 'Sin comentarios')
            ]);
        }

        // üë®‚Äçüîß Firma t√©cnico
        const tecnico = document.getElementById('jockey-tecnico').value;
        const tecnicoCanvas = document.getElementById('jockey-tecnico-signature');
        const tecnicoSignature = await html2canvas(tecnicoCanvas);
        const tecnicoImg = tecnicoSignature.toDataURL('image/png');

        // üß∑ Agregar cada secci√≥n al PDF
        addSection('Bomba Jockey', jockeyData);
        addSection('Bomba El√©ctrica', electricaData);
        addSection('Bomba Diesel', dieselData);
        addSection('Revisi√≥n de Hidrantes', hidrantes);
        addSection('T√©cnico', [['Nombre', tecnico]]);

        doc.addImage(tecnicoImg, 'PNG', 20, yOffset, 80, 30);
        yOffset += 40;

        // ‚úÖ Guardar el PDF
        doc.save('Reporte_Mantenimiento.pdf');
    }
</script>
